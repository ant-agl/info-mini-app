const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MarkdownText-DUGOdKV1.js","./index-ITDkE3uC.js","./index-CRO32DBZ.css"])))=>i.map(i=>d[i]);
import{r as h,_ as V,j as l,R as ye,g as L,c as H,a as T,A as We,aZ as Ge,aL as rt,b as J,aB as at,aC as lt,q as le,a_ as ct,a$ as dt,b0 as ut,m as Te,V as Ye,d as Ve,h as $e,G as ht,b1 as Ae,b2 as Fe,H as Se,J as ft,b3 as vt,b4 as gt,b5 as pt,t as mt,i as ue,aG as Ie,aE as yt,ay as xt,b6 as Mt,b7 as bt,aD as Be,b8 as wt,l as kt,k as qe,az as ae,n as se,b9 as Ct,C as Rt,aP as be,e as ee,p as Et,ba as It,bb as Tt,f as _t,Z as Pt,$ as Nt,bc as At}from"./index-ITDkE3uC.js";import{y as Ue,z as Ft,B as St,D as we,E as je,M as xe,J as _e,u as Bt,w as Pe,K as jt}from"./App-BfnndQAY.js";function Dt(t){return t!==void 0}function Lt(t,n,e){const i=n.filter(Dt);return i.length?t(...i):e}function Ot(t,n){return Lt(Math.min,t,n)}const Ke=h.createContext({size:0});function zt(t){const n=new Set;return(e,i="warn")=>{if(!n.has(e)){n.add(e);const s="%c[VKUI/".concat(t,"] ").concat(e),r=i==="log"?"color: steelblue; font-style: italic":void 0;console[i](s,r)}}}const Ht={stroke:"vkuiImageBaseBadge--background-stroke",shadow:"vkuiImageBaseBadge--background-shadow"},Qe=t=>{var{background:n="shadow"}=t,e=V(t,["background"]);return l.jsx(ye,L(T({},e),{baseClassName:H("vkuiImageBaseBadge",Ht[n])}))};Qe.displayName="ImageBaseBadge";function Ne(t=!0){const{hasPointer:n}=h.useContext(We);return!Ue(!(t||n===void 0))||n!==void 0?n:Ge}function Xt(t){const n=rt(t),[e,i]=h.useState(!1);function s(r){r.detail>0&&i(!1)}return J(()=>{i(n)},[n]),{shown:e&&n,onClick:s}}const Wt=t=>{var{children:n,className:e,getRootRef:i,disableInteractive:s,overlayShown:r}=t,a=V(t,["children","className","getRootRef","disableInteractive","overlayShown"]);const o=at(),{focusVisible:f}=o,d=V(o,["focusVisible"]),m=lt({focusVisible:f,mode:"inside"}),u=ct();return l.jsx("div",L(T(L(T({},a),{tabIndex:0,role:"button",className:H("vkuiImageBaseOverlay--clickable",(f||r)&&"vkuiImageBaseOverlay--visible",m,e),ref:i}),d,u),{children:n}))},Gt=t=>{var{className:n,getRootRef:e,disableInteractive:i,overlayShown:s}=t,r=V(t,["className","getRootRef","disableInteractive","overlayShown"]);const a=le(e),{shown:o,onClick:f}=Xt(a);return l.jsx("div",L(T({},r),{ref:a,className:H((o||s)&&"vkuiImageBaseOverlay--visible",n),onClick:f}))},Je=t=>{var{className:n,theme:e,visibility:i}=t,s=V(t,["className","theme","visibility"]);const r=Ft(),a=Ne(),o=e!=null?e:r,f=i!=null?i:a?"on-hover":"always",m={className:H("vkuiImageBaseOverlay",o==="light"&&"vkuiImageBaseOverlay--theme-light",o==="dark"&&"vkuiImageBaseOverlay--theme-dark",n),overlayShown:f==="always"};return s.disableInteractive?l.jsx(Gt,T({},s,m)):l.jsx(Wt,T({},s,m))};Je.displayName="ImageBaseOverlay";const Yt=24,he=t=>{var{alt:n,crossOrigin:e,decoding:i,loading:s,referrerPolicy:r,sizes:a,src:o,srcSet:f,useMap:d,fetchPriority:m,getRef:u,size:v,width:x,height:C,widthSize:g,heightSize:P,style:_,noBorder:p=!1,fallbackIcon:c,children:w,onLoad:R,onError:k,withTransparentBackground:N}=t,j=V(t,["alt","crossOrigin","decoding","loading","referrerPolicy","sizes","src","srcSet","useMap","fetchPriority","getRef","size","width","height","widthSize","heightSize","style","noBorder","fallbackIcon","children","onLoad","onError","withTransparentBackground"]);const F=v!=null?v:Ot([g,P],Yt),G=g!=null?g:F,z=P!=null?P:F,[$,q]=h.useState(!1),[U,te]=h.useState(!1),Z=o||f,M=(U||!Z)&&h.isValidElement(c)?c:null,S=oe=>{$||(q(!0),te(!1),R==null||R(oe))},Q=oe=>{q(!1),te(!0),k==null||k(oe)},K=le(u),ie=h.useRef(!1);return h.useEffect(function(){if(!ie.current&&(ie.current=!0,K.current&&K.current.complete&&!$)){const ge=new Event("load");K.current.dispatchEvent(ge)}},[K,$]),l.jsx(Ke.Provider,{value:{size:F},children:l.jsxs(dt,L(T({style:T({width:G,height:z},_),baseClassName:H("vkuiImageBase",$&&"vkuiImageBase--loaded",N&&"vkuiImageBase--transparent-background")},j),{children:[Z&&l.jsx("img",T({ref:K,alt:n,className:"vkuiImageBase__img",crossOrigin:e,decoding:i,loading:s,referrerPolicy:r,sizes:a,src:o,srcSet:f,useMap:d,width:x,height:C,onLoad:S,onError:Q},ut(m))),M&&l.jsx("div",{className:"vkuiImageBase__fallback",children:M}),w,!p&&l.jsx("div",{"aria-hidden":!0,className:"vkuiImageBase__border"})]}))})};he.displayName="ImageBase";he.Badge=Qe;he.Badge.displayName="ImageBase.Badge";he.Overlay=Je;he.Overlay.displayName="ImageBase.Overlay";var Vt=Te("Icon20Cancel","cancel_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="cancel_20"><path fill="currentColor" fill-rule="evenodd" d="M4.72 4.72a.75.75 0 0 1 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06" clip-rule="evenodd" /></symbol>',20,20),$t=Te("Icon20DocumentOutline","document_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="document_outline_20"><path fill-rule="evenodd" d="M10.175 1.5H9c-.806 0-1.465.006-2.01.05-.63.052-1.172.16-1.67.413a4.25 4.25 0 0 0-1.857 1.858c-.253.497-.361 1.04-.413 1.67C3 6.103 3 6.864 3 7.816v4.366c0 .952 0 1.713.05 2.327.052.63.16 1.172.413 1.67a4.25 4.25 0 0 0 1.858 1.857c.497.253 1.04.361 1.67.413.613.05 1.374.05 2.326.05h1.366c.952 0 1.713 0 2.327-.05.63-.052 1.172-.16 1.67-.413a4.25 4.25 0 0 0 1.857-1.857c.253-.498.361-1.04.413-1.67.05-.614.05-1.375.05-2.327V8.325c0-.489 0-.733-.055-.963q-.075-.309-.24-.579c-.123-.201-.296-.374-.642-.72l-3.626-3.626c-.346-.346-.519-.519-.72-.642a2 2 0 0 0-.579-.24c-.23-.055-.474-.055-.963-.055M15.5 12.15c0 .992 0 1.692-.045 2.238-.044.537-.127.86-.255 1.11A2.75 2.75 0 0 1 14 16.7c-.252.128-.574.21-1.111.255-.546.044-1.245.045-2.238.045h-1.3c-.992 0-1.692 0-2.238-.045-.537-.044-.86-.127-1.11-.255A2.75 2.75 0 0 1 4.8 15.5c-.128-.252-.21-.574-.255-1.111-.044-.546-.045-1.245-.045-2.238v-4.3c0-.992 0-1.692.045-2.238.044-.537.127-.86.255-1.11A2.75 2.75 0 0 1 6.002 3.3c.25-.128.573-.21 1.11-.255C7.658 3.001 8.358 3 9.35 3H10v2.35c0 .409 0 .761.024 1.051.026.306.083.61.238.902.21.398.537.724.935.935.291.155.596.212.902.238.29.024.642.024 1.051.024h2.35zM14.879 7 11.5 3.621V5.32c0 .447 0 .736.02.955.017.21.047.288.067.326a.75.75 0 0 0 .312.312c.038.02.116.05.326.068.22.018.508.019.955.019z" clip-rule="evenodd" /></symbol>',20,20),qt=Te("Icon24Chevron","chevron_24","0 0 16 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 24" id="chevron_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h16v24H0z" /><path fill="currentColor" d="M4.706 7.706a1 1 0 0 1 0-1.412l.088-.088a.997.997 0 0 1 1.414.002l5.084 5.084a1 1 0 0 1 0 1.416l-5.084 5.084a1 1 0 0 1-1.414.002l-.088-.088a.995.995 0 0 1 0-1.412L9 12z" /></g></symbol>',16,24);const Ut={m:"vkuiScrollArrow--size-m",l:"vkuiScrollArrow--size-l"},Kt={up:"vkuiScrollArrow--direction-up",right:"vkuiScrollArrow--direction-right",down:"vkuiScrollArrow--direction-down",left:"vkuiScrollArrow--direction-left"},Qt={up:"Назад",right:"Вперед",down:"Вперед",left:"Назад"},Jt=({size:t})=>{let n=qt;return t==="m"&&(n=St),l.jsx(n,{className:"vkuiScrollArrow__defaultIcon"})},Me=t=>{var{size:n="l",offsetY:e,direction:i,label:s,children:r=l.jsx(Jt,{size:n})}=t,a=V(t,["size","offsetY","direction","label","children"]);const o=s!=null?s:Qt[i];return l.jsxs(ye,L(T({Component:"button",type:"button",baseClassName:H("vkuiScrollArrow",Ut[n],Kt[i])},a),{children:[o&&l.jsx(Ye,{children:o}),l.jsx("span",{className:"vkuiScrollArrow__icon",style:e?{top:e}:void 0,children:r})]}))};function Zt(t,n){return function(e){const i=e,s=3*t,r=3*(n-t)-s;return(1-s-r)*Math.pow(i,3)+r*Math.pow(i,2)+s*i}}function ne(t,n){return t!=null?t:n}const Ze=()=>{Ve||console.error("[useAdaptivityWithJSMediaQueries] Похоже, вы пытаетесь использовать хук вне браузера.\n\nПостарайтесь этого избегать, чтобы не было ошибок при гидратации: при SSR нет информации о размерах экрана.\n\nИспользуйте CSS Media Query или библиотеку по типу https://github.com/artsy/fresnel.");const{viewWidth:t,viewHeight:n,sizeX:e,sizeY:i,hasPointer:s,hasHover:r}=h.useContext(We),a=$e(),o=ht(),[[f,d],m]=h.useState(()=>[ne(t,Ae(o)),ne(n,Fe(o))]),u=h.useMemo(()=>{const v=ne(s,Ge),x=ne(r,vt),C=ne(t,f),g=ne(n,d),P=ne(e,gt(C)),_=ne(i,pt(C,g,v)),p=mt(C,g,v,a);return{viewWidth:C,viewHeight:g,sizeX:P,sizeY:_,hasPointer:v,hasHover:x,isDesktop:p}},[f,d,t,n,e,i,s,r,a]);return h.useEffect(()=>{const v=()=>{m(x=>{const C=ne(t,Ae(o)),g=ne(n,Fe(o)),[P,_]=x;return P!==C||_!==g?[C,g]:x})};return t||[o.desktopPlus,o.tablet,o.smallTablet,o.mobile].forEach(x=>Se(x,v)),n||[o.mediumHeight,o.mobileLandscapeHeight].forEach(x=>Se(x,v)),()=>{[o.desktopPlus,o.tablet,o.smallTablet,o.mobile,o.mediumHeight,o.mobileLandscapeHeight].forEach(x=>ft(x,v))}},[o,t,n]),u};function en(t,n){return t.length!==n.length?!1:t.every((e,i)=>e===n[i])}const tn=wt.join(),et=t=>{var{Component:n="div",onClose:e,autoFocus:i=!0,restoreFocus:s=!0,disabled:r=!1,mount:a=!0,timeout:o=0,getRootRef:f,children:d}=t,m=V(t,["Component","onClose","autoFocus","restoreFocus","disabled","mount","timeout","getRootRef","children"]);const u=le(f),{document:v}=ue(),x=h.useRef([]),[C,g]=h.useState(null),P=w=>{const R=x.current[w];R&&R.focus({preventScroll:!0})},_=w=>{const R=w.querySelectorAll(tn),k=[];R.forEach(N=>{const{display:j,visibility:F}=getComputedStyle(N);j!=="none"&&F!=="hidden"&&k.push(N)}),k.length===0&&k.push(w),x.current=k},p=w=>{const R=[...x.current];if(_(w),!en(R,x.current)&&v){const k=v.activeElement,N=Math.max(v.activeElement?x.current.indexOf(k):-1,0);P(N)}};J(function(){if(!u.current)return;const R=u.current,k=new MutationObserver(()=>p(R));return k.observe(u.current,{subtree:!0,childList:!0}),_(R),()=>k.disconnect()},[u]),J(function(){if(!u.current||!i||r)return;const k=setTimeout(()=>{if(!u.current||!x.current.length)return;const N=Ie(u.current);yt(u.current,N)||x.current[0].focus()},o);return()=>{clearTimeout(k)}},[i,o,r]);const c=h.useCallback(()=>{const w=typeof s=="function"?s():s;!C||!xt(C)||!w||setTimeout(()=>{C&&(C.focus(),g(null))},o)},[s,C,o]);return J(function(){if(!u.current||!s||!a){g(null);return}g(Ie(u.current))},[u,a,s]),J(function(){return()=>c()},[c]),J(function(){a||c()},[a,c]),J(()=>{if(!u.current)return;const w=k=>{if(r)return;switch(bt(k)){case Be.TAB:{if(!x.current.length)return!1;const j=x.current.length-1,F=x.current.findIndex(z=>z===k.target),G=F===-1||F===j&&!k.shiftKey;if(G||F===0&&k.shiftKey){k.preventDefault();const z=x.current[G?0:j];return z!==Ie(z)&&z.focus(),!1}break}case Be.ESCAPE:e&&(k.preventDefault(),e())}return!0},R=Mt(u.current).document;return R.addEventListener("keydown",w,{capture:!0}),()=>{R.removeEventListener("keydown",w,!0)}},[e,u,r]),l.jsx(n,L(T({tabIndex:-1,ref:u},m),{children:d}))},nn=t=>{var{children:n="Закрыть",className:e}=t,i=V(t,["children","className"]);return l.jsxs(kt,L(T({className:H("vkuiModalDismissButton",e)},i),{activeMode:"vkuiModalDismissButton--active",hoverMode:"vkuiModalDismissButton--hover",children:[n&&l.jsx(Ye,{children:n}),l.jsx(Vt,{})]}))};function sn(t,n,e){function i(s){const r=h.useContext(n);return l.jsx(t,L(T({},s),{[e]:r}))}return i}function on(t){function n(e){const{platform:i}=qe();return l.jsx(t,L(T({},e),{platform:i}))}return n}function rn(t,n){t&&(t.style.transform=n,t.style.webkitTransform=n)}const an=h.createContext(!1),ln=75;function cn(t){return h.Children.toArray(t)}function dn(t,n){if(n.type==="setActive"&&n.id!==t.activeModal){const e=n.id,i=t.exitingModal||t.activeModal;let s=t.history?[...t.history]:[];const r=!!(e&&s.includes(e));return e===null?s=[]:r?s=s.splice(0,s.indexOf(e)+1):s.push(e),{activeModal:e,enteringModal:null,exitingModal:i,history:s,isBack:r}}return n.type==="entered"&&n.id===t.enteringModal?L(T({},t),{enteringModal:null}):n.type==="exited"&&n.id===t.exitingModal?L(T({},t),{exitingModal:null}):n.type==="inited"&&n.id===t.activeModal?L(T({},t),{enteringModal:n.id}):t}function tt(t,n,e=se,i=se,s=se,r=se,a=se){const o=h.useRef({}).current;cn(n).forEach(c=>{const w=c.props,R=we(w),k=R!==void 0&&o[R]||{id:R!=null?R:null};k.onOpen=c.props.onOpen,k.onOpened=c.props.onOpened,k.onClose=c.props.onClose,k.onClosed=c.props.onClosed,k.preventClose=c.props.preventClose,typeof w.settlingHeight=="number"&&(k.settlingHeight=w.settlingHeight),k.id!==null&&(o[k.id]=k)});const d=t&&!o[t]?null:t,[m,u]=h.useReducer(dn,{activeModal:d,enteringModal:null,exitingModal:null,history:d?[d]:[],isBack:!1});J(()=>{u({type:"setActive",id:d!=null?d:null})},[t]),J(()=>{m.activeModal&&(a(o[m.activeModal]),u({type:"inited",id:m.activeModal}))},[m.activeModal]);const v=c=>{var w;return c!=null&&((w=o[c])===null||w===void 0?void 0:w.type)==="card"},x=h.useCallback(c=>{if(c){const w=o[c];ae(w.onOpened)?w.onOpened():ae(i)&&i(c)}u({type:"entered",id:c})},[o,i]),C=h.useCallback(c=>{if(c){const w=o[c];ae(w.onClosed)?w.onClosed():ae(r)&&r(c)}u({type:"exited",id:c})},[o,r]),g=!!(m.exitingModal&&(v(t)||v(m.exitingModal))),P=h.useCallback(c=>c?o[c]:void 0,[o]);function _(){const c=m.activeModal&&o[m.activeModal];c&&(ae(c.onOpen)?c.onOpen():ae(e)&&c.id&&e(c.id))}function p(){const c=m.activeModal&&o[m.activeModal];c&&!c.preventClose&&(ae(c.onClose)?c.onClose():ae(s)&&c.id&&s(c.id))}return L(T({onEnter:_,onEntered:x,onExit:p,onExited:C},m),{delayEnter:g,getModalState:P})}function un(t=se){return function(n){return function(i){const s=tt(i.activeModal,i.children,i.onOpen,i.onOpened,i.onClose,i.onClosed,t);return l.jsx(n,T({},i,s))}}}const hn=zt("ModalRoot");function me(t,n){return n?t>=n[0]&&t<=n[1]:!1}function De(t){return be(t,0,98)}class fn extends h.Component{get timeout(){return this.props.platform==="ios"?400:320}get document(){return this.props.document}get window(){return this.props.window}getModals(){return h.Children.toArray(this.props.children)}componentDidMount(){var n;(n=this.window)===null||n===void 0||n.addEventListener("resize",this.updateModalHeight,!1)}componentWillUnmount(){this.toggleDocumentScrolling(!0),this.window.removeEventListener("resize",this.updateModalHeight,!1)}componentDidUpdate(n){if(this.props.exitingModal&&this.props.exitingModal!==n.exitingModal&&this.closeModal(this.props.exitingModal),this.props.enteringModal&&this.props.enteringModal!==n.enteringModal){const e=this.props.getModalState(this.props.enteringModal);this.props.onEnter(),this.waitTransitionFinish(e,()=>{e&&(e.innerElement&&(e.innerElement.style.transitionDelay=""),this.onEntered(e))}),e!=null&&e.innerElement&&(e.innerElement.style.transitionDelay=this.props.delayEnter?"".concat(this.timeout,"ms"):"",this.animateTranslate(e,e.translateY),this.setMaskOpacity(e,1))}this.props.activeModal&&!n.activeModal&&(this.restoreFocusTo=this.document.activeElement),!this.props.activeModal&&!this.props.exitingModal&&this.restoreFocusTo&&(this.restoreFocusTo.focus(),this.restoreFocusTo=null),this.toggleDocumentScrolling(!this.props.activeModal&&!this.props.exitingModal)}toggleDocumentScrolling(n){this.documentScrolling!==n&&(this.documentScrolling=n,n?(this.document.documentElement.classList.remove("vkui--disable-overscroll-behavior"),this.window.removeEventListener("touchmove",this.preventTouch,{passive:!1})):(this.document.documentElement.classList.add("vkui--disable-overscroll-behavior"),this.window.addEventListener("touchmove",this.preventTouch,{passive:!1})))}checkPageContentHeight(){const n=this.props.getModalState(this.props.activeModal);if((n==null?void 0:n.type)==="page"&&(n!=null&&n.modalElement)){const e=T({},n);nt(n);const i=T({},n);let s=!1;e.expandable===i.expandable?e.translateYFrom!==i.translateYFrom&&(s=!0):s=!0,s&&this.animateTranslate(n,n.translateY)}}onEntered({id:n,modalElement:e}){!this.props.noFocusToDialog&&e&&!e.contains(this.document.activeElement)&&e.focus(),this.props.onEntered(n)}closeModal(n){this.setState({touchDown:!1});const e=this.props.getModalState(n);if(!e){n&&hn("closeActiveModal: модальное окно (страница) ".concat(n," не существует"),"error");return}this.state.modalOpenedLog.length||this.setState(m=>({modalOpenedLog:[...m.modalOpenedLog,n]}));const i=this.props.getModalState(this.props.activeModal),s=!!i&&i.type==="page",r=!!e&&e.type==="page";this.waitTransitionFinish(e,()=>this.props.onExited(n));var a,o,f;const d=r&&s&&((a=e.translateY)!==null&&a!==void 0?a:0)<=((o=i==null?void 0:i.translateYFrom)!==null&&o!==void 0?o:0)&&!this.props.isBack?((f=i==null?void 0:i.translateYFrom)!==null&&f!==void 0?f:0)+10:100;this.animateTranslate(e,d),i?i.id&&!this.state.modalOpenedLog.includes(i.id)&&(i.translateY=void 0,this.setState(m=>({modalOpenedLog:[...m.modalOpenedLog,i.id]}))):(this.setMaskOpacity(e,0),this.setState({modalOpenedLog:[]}),e.translateY=void 0,e.expandable=void 0)}onPageTouchMove(n,e){var i,s;const{shiftY:r,originalEvent:a}=n,o=a.target;if(!n.isY){var f;!((f=this.viewportRef.current)===null||f===void 0)&&f.contains(o)&&a.preventDefault();return}if(!(!((i=e.innerElement)===null||i===void 0)&&i.contains(o)))return a.preventDefault();a.stopPropagation();const{expandable:d,contentScrolled:m,collapsed:u,expanded:v}=e;if(!this.state.touchDown){var x,C;e.touchStartContentScrollTop=(C=(x=e.contentElement)===null||x===void 0?void 0:x.scrollTop)!==null&&C!==void 0?C:0,this.setState({touchDown:!0})}if(!m&&(e.touchMovePositive===null&&(e.touchMovePositive=r>0),!e.expandable||u||v&&e.touchMovePositive&&e.touchStartContentScrollTop===0||!((s=e.headerElement)===null||s===void 0)&&s.contains(o))){if(a.preventDefault(),!d&&r<0||!this.window)return;!this.state.dragging&&this.setState({dragging:!0});const P=r/this.window.innerHeight*100,_=je(P,72,.8,this.props.platform!=="ios");e.touchShiftYPercent=P;var g;e.translateYCurrent=De(((g=e.translateY)!==null&&g!==void 0?g:0)+_),this.animateTranslate(e,e.translateYCurrent),this.setMaskOpacity(e)}}onCardTouchMove(n,e){var i;const{originalEvent:s,shiftY:r}=n,a=s.target;if(!((i=e.innerElement)===null||i===void 0)&&i.contains(a)){this.state.touchDown||this.setState({touchDown:!0,dragging:!0});const f=r/e.innerElement.offsetHeight*100,d=je(f,72,1.2,this.props.platform!=="ios");e.touchShiftYPercent=f;var o;e.translateYCurrent=Math.max(0,((o=e.translateY)!==null&&o!==void 0?o:0)+d),this.animateTranslate(e,e.translateYCurrent),this.setMaskOpacity(e)}}onPageTouchEnd(n,e){const{startY:i,shiftY:s}=n;e.contentScrolled=!1,e.touchMovePositive=null;let r;if(this.state.dragging&&this.window){const C=(i+s)/this.window.innerHeight*100;var a;let g=(a=e.translateYCurrent)!==null&&a!==void 0?a:0;var o;const P=g/n.duration*240*.6*(((o=e.touchShiftYPercent)!==null&&o!==void 0?o:0)<0?-1:1);if(g=De(g+P),e.settlingHeight!==100)if(me(g,e.expandedRange)){var f,d;g=(d=(f=e.expandedRange)===null||f===void 0?void 0:f[0])!==null&&d!==void 0?d:0}else if(me(g,e.collapsedRange)){var m;g=(m=e.translateYFrom)!==null&&m!==void 0?m:0}else if(me(g,e.hiddenRange)){var u;g=e.preventClose?(u=e.translateYFrom)!==null&&u!==void 0?u:0:100}else{var v;g=(v=e.translateYFrom)!==null&&v!==void 0?v:0}else if(me(g,[0,25]))g=0;else{var x;g=e.preventClose?(x=e.translateYFrom)!==null&&x!==void 0?x:0:100}g!==100&&C>=75&&!e.preventClose&&(g=100),e.translateY=g,e.translateYCurrent=g,e.collapsed=me(g,e.collapsedRange),e.expanded=g===0,e.hidden=g===100,e.hidden&&this.props.onExit(),r=()=>{e.hidden||this.animateTranslate(e,e.translateY),this.setMaskOpacity(e)}}this.setState({touchDown:!1,dragging:!1},r)}onCardTouchEnd({duration:n},e){let i;if(this.state.dragging){var s;let a=(s=e.translateYCurrent)!==null&&s!==void 0?s:0;var r;const o=a/n*240*.6*(((r=e.touchShiftYPercent)!==null&&r!==void 0?r:0)<0?-1:1);a=Math.max(0,a+o),a>=30?a=100:a=0,e.translateY=a,e.hidden=a===100,e.hidden&&this.props.onExit(),i=()=>{e.hidden||this.animateTranslate(e,e.translateY),this.setMaskOpacity(e)}}this.setState({touchDown:!1,dragging:!1},i)}waitTransitionFinish(n,e){const i=n?n.innerElement:null;i?i.addEventListener("transitionend",e,{once:!0}):setTimeout(e,this.timeout)}animateTranslate(n,e){const i="animateTranslateFrame".concat(n.id);cancelAnimationFrame(this.frameIds[i]),this.frameIds[i]=requestAnimationFrame(()=>{rn(n.innerElement,"translate3d(0, ".concat(e,"%, 0)"))})}setMaskOpacity(n,e=null){var i;e===null&&((i=this.props.history)===null||i===void 0?void 0:i[0])!==n.id||(this.maskAnimationFrame&&cancelAnimationFrame(this.maskAnimationFrame),this.maskAnimationFrame=requestAnimationFrame(()=>{if(this.maskElementRef.current){const{translateY:s=0,translateYCurrent:r=0}=n,a=e===null?1-(r-s)/(100-s)||0:e;this.maskElementRef.current.style.opacity=be(a,0,100).toString(),this.maskElementRef.current.style.transitionDelay=a&&this.props.delayEnter?"".concat(this.timeout,"ms"):""}}))}render(){var n;const{activeModal:e,exitingModal:i,enteringModal:s,modalOverlayTestId:r}=this.props,{touchDown:a,dragging:o}=this.state;return!e&&!i?null:l.jsx(an.Provider,{value:!0,children:l.jsx(xe.Provider,{value:this.modalRootContext,children:l.jsxs(_e,{className:H("vkuiModalRoot",((n=this.props.configProvider)===null||n===void 0?void 0:n.hasCustomPanelHeaderAfter)&&"vkuiModalRoot--hasCustomPanelHeaderAfterSlot",a&&H("vkuiModalRoot--touched","vkuiInternalModalRoot--touched"),!!(s||i)&&H("vkuiModalRoot--switching","vkuiInternalModalRoot--switching")),onMove:this.onTouchMove,onEnd:this.onTouchEnd,onScroll:this.onScroll,children:[l.jsx("div",{"data-testid":r,className:"vkuiModalRoot__mask",onClick:this.props.onExit,ref:this.maskElementRef}),l.jsx("div",{className:"vkuiModalRoot__viewport",ref:this.viewportRef,children:this.getModals().map(f=>{const d=we(f.props),m=this.props.getModalState(d);if(d!==e&&d!==i||!m)return null;const u=T({},m),v=u.type==="page",x="modal-".concat(d);return l.jsx(et,{onClose:this.props.onExit,timeout:this.timeout,className:H("vkuiModalRoot__modal",o&&"vkuiInternalModalRoot__modal--dragging",v&&u.expandable&&"vkuiInternalModalRoot__modal--expandable",v&&u.collapsed&&"vkuiInternalModalRoot__modal--collapsed"),autoFocus:!1,restoreFocus:!1,children:f},x)})})]})})})}constructor(n){super(n),ee(this,"documentScrolling",!1),ee(this,"maskElementRef",void 0),ee(this,"viewportRef",h.createRef()),ee(this,"maskAnimationFrame",void 0),ee(this,"modalRootContext",void 0),ee(this,"frameIds",void 0),ee(this,"restoreFocusTo",void 0),ee(this,"preventTouch",e=>{if(!e)return!1;for(;e.originalEvent;)e=e.originalEvent;return e.preventDefault&&e.preventDefault(),!1}),ee(this,"updateModalHeight",()=>{const e=this.props.getModalState(this.props.activeModal);e&&e.type==="page"&&(this.props.enteringModal?this.waitTransitionFinish(e,()=>{requestAnimationFrame(()=>this.checkPageContentHeight())}):requestAnimationFrame(()=>this.checkPageContentHeight()))}),ee(this,"onTouchMove",e=>{if(this.props.exitingModal)return;const i=this.props.getModalState(this.props.activeModal);if(i){if(i.type==="page")return this.onPageTouchMove(e,i);if(i.type==="card")return this.onCardTouchMove(e,i)}}),ee(this,"onTouchEnd",e=>{const i=this.props.getModalState(this.props.activeModal);if((i==null?void 0:i.type)==="page")return this.onPageTouchEnd(e,i);if((i==null?void 0:i.type)==="card")return this.onCardTouchEnd(e,i)}),ee(this,"onScroll",e=>{var i;const s=this.props.activeModal,r=e.target;if(!s)return;const a=this.props.getModalState(s);(a==null?void 0:a.type)==="page"&&(!(a==null||(i=a.contentElement)===null||i===void 0)&&i.contains(r))&&(a.contentScrolled=!0,a.contentScrollStopTimeout&&clearTimeout(a.contentScrollStopTimeout),a.contentScrollStopTimeout=setTimeout(()=>{a.contentScrolled&&(a.contentScrolled=!1)},250))}),this.state={touchDown:!1,dragging:!1,modalOpenedLog:[]},this.maskElementRef=h.createRef(),this.modalRootContext={updateModalHeight:this.updateModalHeight,registerModal:e=>{var{id:i}=e,s=V(e,["id"]),r;return Object.assign((r=this.props.getModalState(i))!==null&&r!==void 0?r:{},s)},onClose:()=>this.props.onExit(),isInsideModal:!0},this.frameIds={}}}const vn=sn(on(Ct(un(gn)(fn))),Rt,"configProvider");function gn(t){switch(t.type){case"page":return t.settlingHeight=t.settlingHeight||ln,nt(t);case"card":return pn(t)}}function nt(t){const{contentElement:n,bottomInset:e}=t,i=mn(n==null?void 0:n.firstElementChild,t.expandable),s=(e==null?void 0:e.offsetHeight)||0,r=i+s;let a=t.translateY,o=t.expandable;var f;t.expandable=r>((f=n==null?void 0:n.clientHeight)!==null&&f!==void 0?f:0)||t.settlingHeight===100;let d=!1,m=!1,u,v,x,C,g;const P=!!(t.expandable&&t.settlingHeight!==100);if(t.expandable){var _;u=100-((_=t.settlingHeight)!==null&&_!==void 0?_:0);const j=u/2,F=100-u;x=[0,j],C=P?[j,u+F/4]:void 0,g=[u+F/4,100],d=P&&u>0,m=u<=0,v=u}else{var p,c,w,R;const j=(R=(p=t.headerElement)===null||p===void 0?void 0:p.offsetHeight)!==null&&R!==void 0?R:0,F=r+j;var k;u=100-F/((k=(w=t.innerElement)===null||w===void 0||(c=w.parentElement)===null||c===void 0?void 0:c.offsetHeight)!==null&&k!==void 0?k:0)*100,v=u,x=[v,v+25],C=void 0,g=[v+25,v+100]}(o&&t.expandable&&v>(a!=null?a:100)||t.settlingHeight===100)&&(v=0),v===0&&(m=!0,d=!1),t.expandedRange=x,t.collapsedRange=C,t.hiddenRange=g,t.translateY=v,t.translateYFrom=u,t.collapsed=d,t.expanded=m}function pn(t){t.translateY=0}function mn(t,n){if(!n)return t.scrollHeight;const e=t.style.height;t.style.height="auto";const i=t.scrollHeight;return t.style.height=e,i}const yn=()=>{const t=h.useRef(null),{document:n}=ue(),e=h.useRef(se),i=h.useCallback(()=>{e.current(),e.current=se},[]);return h.useCallback((r,a,o)=>{r&&(n!=null&&n.hidden?(t!=null&&t.current&&clearTimeout(t.current),t.current=setTimeout(a,o)):(i(),r.addEventListener("transitionend",a),e.current=()=>{r.removeEventListener("transitionend",a)}))},[n,i,t])},xn=({activeModal:t,children:n,noFocusToDialog:e=!1,onOpen:i,onOpened:s,onClose:r,onClosed:a,modalOverlayTestId:o})=>{const f=h.useRef(null),d=h.useRef(void 0),m=h.useRef(void 0),{document:u}=ue(),{hasCustomPanelHeaderAfter:v,platform:x}=qe(),{activeModal:C,exitingModal:g,onExit:P,getModalState:_,enteringModal:p,onEnter:c,onEntered:w,onExited:R,history:k,delayEnter:N}=tt(t,n,i,s,r,a,se),j=yn(),F=Bt({exitingModal:g,enteringModal:p,activeModal:C}),G=Et({updateModalHeight:()=>{},registerModal:M=>{var{id:S}=M,Q=V(M,["id"]),K;return Object.assign((K=_(S))!==null&&K!==void 0?K:{},Q)},onClose:P,isInsideModal:!0}),z=x==="ios"?400:320,$=h.Children.toArray(n),q=(M,S)=>{M!=null&&M.innerElement&&(M.innerElement.style.transition="",M.innerElement.style.transitionDelay=S&&N?"".concat(z,"ms"):"",M.innerElement.style.opacity=S?"1":"0")},U=(M,S=null)=>{S===null&&(k==null?void 0:k[0])!==M.id||(d.current&&cancelAnimationFrame(d.current),d.current=requestAnimationFrame(()=>{if(f.current){const{translateY:Q=0,translateYCurrent:K=0}=M,ie=S===null?1-(K-Q)/(100-Q)||0:S;f.current.style.opacity=be(ie,0,100).toString()}}))},te=({id:M,modalElement:S})=>{!e&&S&&!S.contains(u.activeElement)&&S.focus(),w(M)},Z=()=>{if(!p||!F)return;const M=_(p);if(c(),!F.exitingModal){requestAnimationFrame(()=>{p===p&&M&&(j(M.innerElement,()=>te(M),z),q(M,!0),U(M,1))});return}requestAnimationFrame(()=>{M!=null&&M.innerElement&&(M.innerElement.style.transition="none",M.innerElement.style.opacity="1",U(M,1))}),M&&te(M)},fe=M=>{const S=_(M);if(S){if(!C){requestAnimationFrame(()=>{j(S==null?void 0:S.innerElement,()=>R(M),z),q(S,!1),U(S,0)});return}R(M)}};return h.useEffect(()=>{if(F){if(g&&g!==F.exitingModal&&fe(g),p&&p!==F.enteringModal&&Z(),C&&!F.activeModal){var M;m.current=(M=u==null?void 0:u.activeElement)!==null&&M!==void 0?M:void 0}!C&&!g&&m.current&&(m.current.focus(),m.current=void 0)}}),!C&&!g?null:l.jsx(xe.Provider,{value:G,children:l.jsxs("div",{className:H("vkuiModalRoot",v&&"vkuiModalRoot--hasCustomPanelHeaderAfterSlot","vkuiModalRoot--desktop"),children:[l.jsx("div",{"data-testid":o,className:"vkuiModalRoot__mask",ref:f,onClick:P}),l.jsx("div",{className:"vkuiModalRoot__viewport",children:$.map(M=>{const S=we(M.props);if(S!==C&&S!==g)return null;const Q="modal-".concat(S);return l.jsx(et,{autoFocus:!1,restoreFocus:!1,onClose:P,timeout:z,className:"vkuiModalRoot__modal",children:M},Q)})})]})})},Mn=t=>{const{isDesktop:n}=Ze();It(!!t.activeModal);const e=n?xn:vn;return l.jsx(e,T({},t))};function Le(t){var n,e;if(!t)return"portrait";var i;return Math.abs((i=(e=t.screen)===null||e===void 0||(n=e.orientation)===null||n===void 0?void 0:n.angle)!==null&&i!==void 0?i:Number(t.orientation))===90?"landscape":"portrait"}function bn(){const{window:t}=ue(),[n,e]=h.useState(()=>Le(t));return Pe(t,"orientationchange",()=>e(Le(t))),n}const wn=h.createContext({}),kn={s:"vkuiModalPage--size-s",m:"vkuiModalPage--size-m",l:"vkuiModalPage--size-l"},Cn=t=>{var{children:n,header:e,size:i="s",onOpen:s,onOpened:r,onClose:a,onClosed:o,settlingHeight:f,dynamicContentHeight:d,getModalContentRef:m,nav:u,id:v,hideCloseButton:x=!1,height:C,modalContentTestId:g,modalDismissButtonTestId:P,getRootRef:_,preventClose:p}=t,c=V(t,["children","header","size","onOpen","onOpened","onClose","onClosed","settlingHeight","dynamicContentHeight","getModalContentRef","nav","id","hideCloseButton","height","modalContentTestId","modalDismissButtonTestId","getRootRef","preventClose"]);const w=h.useId(),R=v||w,{updateModalHeight:k}=h.useContext(xe),N=$e(),j=bn(),{sizeX:F,isDesktop:G}=Ze();h.useEffect(()=>{d&&k()},[n,d,j,k]);const z=!x&&G,$=G?i:"s",q=h.useContext(xe),{refs:U}=jt(we({nav:u,id:R}),"page"),te=le(_,U.modalElement),Z=h.useMemo(()=>({labelId:"".concat(R,"-label")}),[R]);return l.jsx(wn.Provider,{value:Z,children:l.jsx(ye,L(T({},c),{getRootRef:te,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":Z.labelId,id:R,baseClassName:H("vkuiModalPage",N==="ios"&&"vkuiModalPage--ios",G&&"vkuiModalPage--desktop",F==="regular"&&"vkuiInternalModalPage--sizeX-regular",typeof $=="string"&&kn[$]),children:l.jsx("div",{className:"vkuiModalPage__in-wrap",style:{maxWidth:typeof $=="number"?$:void 0,height:C},ref:U.innerElement,children:l.jsxs("div",{className:"vkuiModalPage__in",children:[l.jsx("div",{className:"vkuiModalPage__header",ref:U.headerElement,children:e}),l.jsxs("div",{className:"vkuiModalPage__content-wrap",children:[l.jsx("div",L(T({className:"vkuiModalPage__content",ref:Tt(U.contentElement,m)},g&&{"data-testid":g}),{children:l.jsx("div",{className:"vkuiModalPage__content-in",children:n})})),l.jsx("div",{ref:U.bottomInset,className:"vkuiModalPage__bottom-inset"})]}),z&&l.jsx(nn,{"data-testid":P,onClick:a||q.onClose})]})})}))})},Rn=({containerWidth:t=0,layerWidth:n=0,slides:e=[],viewportOffsetWidth:i=0,align:s,isCenterWithCustomWidth:r})=>{switch(s){case"left":return t-n;case"right":return i-n;case"center":if(r&&e.length){const{coordX:a,width:o}=e[e.length-1];return i/2-a-o/2}else return i-(t-i)/2-n}},En=({slides:t=[],viewportOffsetWidth:n=0,isCenterWithCustomWidth:e})=>{if(e&&t.length){const{width:i,coordX:s}=t[0];return n/2-s-i/2}return 0},Oe=.24,In={containerWidth:0,viewportOffsetWidth:0,layerWidth:0,min:0,max:0,slides:[],isFullyVisible:!0},Tn={animation:void 0,shiftX:0,dragging:!1,deltaX:0,indent:0},_n={dark:"vkuiBaseGallery__bullets--dark",light:"vkuiBaseGallery__bullets--light"},Pn=t=>{var{bullets:n=!1,getRootRef:e,children:i,slideWidth:s="100%",slideIndex:r=0,dragDisabled:a=!1,onDragStart:o,onDragEnd:f,onChange:d,onPrevClick:m,onNextClick:u,align:v="left",showArrows:x,getRef:C,arrowSize:g="l"}=t,P=V(t,["bullets","getRootRef","children","slideWidth","slideIndex","dragDisabled","onDragStart","onDragEnd","onChange","onPrevClick","onNextClick","align","showArrows","getRef","arrowSize"]);const _=h.useRef({}),p=h.useRef(In),[c,w]=h.useState(Tn),R=le(e),k=le(C),{window:N}=ue(),j=Ne(),F=s==="custom"&&v==="center",G=E=>{var I;const O=(I=p.current.max)!==null&&I!==void 0?I:0;var y;const b=(y=p.current.min)!==null&&y!==void 0?y:0;return E<b?b:E>O?O:E},z=E=>{var I;if(p.current.isFullyVisible)return 0;const O=!((I=p.current.slides)===null||I===void 0)&&I.length?p.current.slides[E]:null;if(O){const{coordX:b,width:A}=O;if(F){var y;return((y=p.current.viewportOffsetWidth)!==null&&y!==void 0?y:0)/2-b-A/2}return G(-1*b)}return 0},$=()=>{var E;const I=(E=p.current.max)!==null&&E!==void 0?E:0;var O;const y=(O=p.current.min)!==null&&O!==void 0?O:0,b=c.shiftX+c.deltaX;return b>I?I+Number((b-I)/3):b<y?y+Number((b-y)/3):b},q=(E={})=>{var I,O,y,b,A;const B=(A=h.Children.map(i,(ce,de)=>{const ve=_.current["slide-".concat(de)];var Re,Ee;return{coordX:(Re=ve==null?void 0:ve.offsetLeft)!==null&&Re!==void 0?Re:0,width:(Ee=ve==null?void 0:ve.offsetWidth)!==null&&Ee!==void 0?Ee:0}}))!==null&&A!==void 0?A:[];var D;const X=(D=(I=R.current)===null||I===void 0?void 0:I.offsetWidth)!==null&&D!==void 0?D:0;var Y;const W=(Y=(O=k.current)===null||O===void 0?void 0:O.offsetWidth)!==null&&Y!==void 0?Y:0,re=B.reduce((ce,de)=>de.width+ce,0),ot=B.length<=p.current.slides.length||((y=p.current.slides[r])===null||y===void 0?void 0:y.coordX)!==((b=B[r])===null||b===void 0?void 0:b.coordX);p.current={containerWidth:X,viewportOffsetWidth:W,layerWidth:re,max:En({slides:B,viewportOffsetWidth:W,isCenterWithCustomWidth:F}),min:Rn({containerWidth:X,layerWidth:re,slides:B,viewportOffsetWidth:W,isCenterWithCustomWidth:F,align:v}),slides:B,isFullyVisible:re<=X},w(ce=>{var de;return L(T({},ce),{shiftX:ot?z(r):ce.shiftX,animation:(de=E.animation)!==null&&de!==void 0?de:ce.shiftX===G(ce.shiftX)})})};Pe(N,"resize",()=>{c.animation!==void 0&&q({animation:!1})}),J(()=>{q({animation:!1})},[i,v,s]),J(()=>{c.animation!==void 0&&w(E=>L(T({},E),{animation:!0,deltaX:0,shiftX:z(r!=null?r:0)}))},[r]);const te=E=>{d==null||d(r-1),m==null||m(E)},Z=E=>{d==null||d(r+1),u==null||u(E)},fe=E=>{const I=c.deltaX/E.duration*240*.6;var O;const y=c.shiftX+c.deltaX+I-((O=p.current.max)!==null&&O!==void 0?O:0),b=c.deltaX<0?1:-1;let A=p.current.slides.reduce((B,D,X)=>{const Y=Math.abs(p.current.slides[B].coordX+y),W=Math.abs(D.coordX+y);return Y<W?B:X},r);if(A===r){let B=r+b;B>=0&&B<p.current.slides.length&&Math.abs(c.deltaX)>p.current.slides[B].width*.05&&(A=B)}return A},M=!a&&!p.current.isFullyVisible,S=E=>{E.originalEvent.stopPropagation(),M&&(o==null||o(E),w(I=>L(T({},I),{animation:!1})))},Q=E=>{M&&(E.originalEvent.preventDefault(),E.isSlideX&&c.deltaX!==E.shiftX&&w(I=>L(T({},I),{deltaX:E.shiftX,dragging:E.isSlideX})))},K=E=>{if(M){const I=E.isSlide?fe(E):r!=null?r:0;f==null||f(E,I);const O={animation:!0,dragging:!1,deltaX:0},y=$();I!==r&&(O.shiftX=y),w(b=>T({},b,O)),I!==r&&(d==null||d(I))}},ie=c.dragging?$():c.shiftX,oe={WebkitTransform:"translateX(".concat(ie,"px)"),transform:"translateX(".concat(ie,"px)"),WebkitTransition:c.animation?"-webkit-transform ".concat(Oe,"s cubic-bezier(.1, 0, .25, 1)"):"none",transition:c.animation?"transform ".concat(Oe,"s cubic-bezier(.1, 0, .25, 1)"):"none"},ge=(E,I)=>{_.current["slide-".concat(I)]=E},ke=!p.current.isFullyVisible&&c.shiftX<0;var pe;const Ce=!p.current.isFullyVisible&&(v==="left"&&p.current.containerWidth-c.shiftX<((pe=p.current.layerWidth)!==null&&pe!==void 0?pe:0)||v!=="left"&&r<p.current.slides.length-1);return l.jsxs(ye,L(T({},P),{baseClassName:H("vkuiBaseGallery",v==="center"&&"vkuiBaseGallery--align-center",s==="custom"&&"vkuiBaseGallery--custom-width",M&&"vkuiBaseGallery--draggable"),getRootRef:R,children:[l.jsx(_e,{className:"vkuiBaseGallery__viewport",onStartX:S,onMoveX:Q,onEnd:K,style:{width:s==="custom"?"100%":s},getRootRef:k,noSlideClick:!0,children:l.jsx("div",{className:"vkuiBaseGallery__layer",style:oe,children:h.Children.map(i,(E,I)=>l.jsx("div",{className:"vkuiBaseGallery__slide",ref:O=>ge(O,I),children:E},"slide-".concat(I)))})}),n&&l.jsx("div",{"aria-hidden":!0,className:H("vkuiBaseGallery__bullets",_n[n]),children:h.Children.map(i,(E,I)=>l.jsx("div",{className:H("vkuiBaseGallery__bullet",I===r&&"vkuiBaseGallery__bullet--active")},I))}),x&&j&&ke&&l.jsx(Me,{className:"vkuiBaseGallery__arrow",direction:"left",onClick:te,size:g}),x&&j&&Ce&&l.jsx(Me,{className:"vkuiBaseGallery__arrow",direction:"right",onClick:Z,size:g})]}))},it=240,Nn=.05,An={canSlideLeft:!0,canSlideRight:!0,isDraggable:!0},Fn={viewportOffsetWidth:0,slides:[],isFullyVisible:!0,loopPoints:[],contentSize:0,snaps:[]};function Sn(t,n,e){if(n.isFullyVisible||!n.slides.length)return 0;const i=n.slides[t];if(i){const{coordX:s,width:r}=i;return e?n.viewportOffsetWidth/2-s-r/2:-1*s}return 0}function ze(t,n,e){let i=e;const s=[],r=t===1?0:n.length-1,a=t===1?n.length-1:0;for(let o=r;(t===1?o<=a:o>=a)&&i>0;o+=t){const f=n[o].width;i>0&&s.push(o),i-=f}return s}function He(t,n,e,i){const{contentSize:s,slides:r,snaps:a}=e,o=n==="start",f=o?-s:s;return t.map(d=>{const m=o?0:-s,u=o?s:0,v=o?a[d]+i+f:a[d]-r[d].width+f-a[0];return{index:d,target:x=>x>=v?m:u}})}function Bn(t,n){const{slides:e,snaps:i}=t,s=ze(-1,e,i[0]),r=ze(1,e,n-i[0]);return[...He(r,"start",t,n),...He(s,"end",t,n)]}function jn(t,n,e,i){const s=e+i,r=i<0?1:-1;let a=t.reduce((o,f,d)=>{const m=Math.abs(t[o].coordX+s),u=Math.abs(f.coordX+s);return m<u?o:d},n);if(a===n){let o=n+r;return o>=0&&o<t.length?Math.abs(i)>t[o].width*Nn?o:a:r<0?(o+t.length)%t.length:o%t.length}return a}function Dn({duration:t,timing:n,draw:e,animationQueue:i=[]}){if(!Ve)return;let s;requestAnimationFrame(function r(a){s||(s=a);let o=Math.min((a-s)/t,1);const f=n(o);if(e(f),o<1){requestAnimationFrame(r);return}i.shift(),i.length>0&&i[0]()})}const Ln=Zt(.8,1);function On(){const t=h.useRef([]);function n(s){return()=>{Dn({duration:it,timing:Ln,animationQueue:t.current,draw:s})}}function e(s){t.current.push(s)}function i(){t.current.length===1&&t.current[0]()}return{getAnimateFunction:n,addToAnimationQueue:e,startAnimation:i}}const zn={dark:"vkuiBaseGallery__bullets--dark",light:"vkuiBaseGallery__bullets--light"},Hn=t=>{var{bullets:n=!1,getRootRef:e,children:i,slideWidth:s="100%",slideIndex:r=0,dragDisabled:a=!1,onDragStart:o,onDragEnd:f,onChange:d,onPrevClick:m,onNextClick:u,align:v="left",showArrows:x,getRef:C,arrowSize:g="l"}=t,P=V(t,["bullets","getRootRef","children","slideWidth","slideIndex","dragDisabled","onDragStart","onDragEnd","onChange","onPrevClick","onNextClick","align","showArrows","getRef","arrowSize"]);const _=h.useRef({}),p=h.useRef(Fn),c=le(e),w=le(C),R=h.useRef(null),k=h.useRef(null),N=h.useRef(0),j=h.useRef(0),F=h.useRef(!1),{addToAnimationQueue:G,getAnimateFunction:z,startAnimation:$}=On(),[q,U]=h.useState(An),{window:te}=ue(),Z=Ne(),fe=s==="custom"&&v==="center",M=(y,b=!1)=>{p.current.loopPoints.forEach(A=>{const{target:B,index:D}=A,X=_.current[D];X&&(X.style.transform="translate3d(".concat(B(y),"px, 0, 0)"))}),R.current&&(R.current.style.transform="translate3d(".concat(y,"px, 0, 0)"),R.current.style.transition=b?"transform ".concat(it,"ms cubic-bezier(.1, 0, .25, 1)"):"")},S=(y,b=!1)=>{const{snaps:A,contentSize:B,slides:D}=p.current;k.current!==null&&cancelAnimationFrame(k.current),k.current=requestAnimationFrame(()=>{y>A[0]&&(N.current=-B+A[0],y=N.current+j.current);const X=D[D.length-1].width+D[D.length-1].coordX;y<=-X&&(N.current=Math.abs(j.current)+A[0]),M(y,b)})},Q=()=>{if(!c.current||!w.current)return;let y=h.Children.map(i,(Y,W)=>{const re=_.current[W]||{offsetLeft:0,offsetWidth:0};return{coordX:re.offsetLeft,width:re.offsetWidth}})||[];const b=c.current.offsetWidth,A=w.current.offsetWidth,B=y.reduce((Y,W)=>W.width+Y,0);if(v==="center"){const Y=(b-y[0].width)/2;y=y.map(W=>({width:W.width,coordX:W.coordX-Y}))}p.current=L(T({},p.current),{viewportOffsetWidth:A,slides:y,isFullyVisible:B<=b});const D=y.map((Y,W)=>Sn(W,p.current,fe));let X=-D[D.length-1]+y[y.length-1].width;v==="center"&&(X+=D[0]),p.current.snaps=D,p.current.contentSize=X,p.current.loopPoints=Bn(p.current,b),U({canSlideLeft:!p.current.isFullyVisible,canSlideRight:!p.current.isFullyVisible,isDraggable:!(a||p.current.isFullyVisible)}),N.current=D[r],F.current=!0,S(N.current)};Pe(te,"resize",()=>{F.current&&Q()}),J(function(){if(!F.current)return;const{snaps:b,slides:A}=p.current,B=b[r];let D=N.current;if(B===b[0]&&N.current<=b[b.length-1]){const X=Math.abs(b[b.length-1])+A[A.length-1].width+D;G(z(Y=>{const W=D+Y*X*-1;M(W),W<=b[b.length-1]-A[A.length-1].width&&requestAnimationFrame(()=>{N.current=B,M(b[0])})}))}else B===b[b.length-1]&&N.current===b[0]?(D=B-A[A.length-1].width,G(()=>{requestAnimationFrame(()=>{const X=B-A[A.length-1].width;M(X),z(Y=>{M(D+Y*A[A.length-1].width)})()})})):G(()=>{const X=Math.abs(B-D);let Y=D<=B?1:-1;z(W=>{const re=D+W*X*Y;M(re)})()});$(),N.current=B},[r]),J(()=>{Q()},[i,v,s]);const ie=y=>{d==null||d((r-1+p.current.slides.length)%p.current.slides.length),m==null||m(y)},oe=y=>{d==null||d((r+1)%p.current.slides.length),u==null||u(y)},ge=y=>{y.originalEvent.stopPropagation(),q.isDraggable&&(o==null||o(y),N.current=p.current.snaps[r],j.current=0)},ke=y=>{q.isDraggable&&(y.originalEvent.preventDefault(),y.isSlideX&&j.current!==y.shiftX&&(j.current=y.shiftX,S(N.current+j.current)))},pe=y=>{if(q.isDraggable){let b=r;if(y.isSlide&&(b=jn(p.current.slides,r,N.current,j.current)),f==null||f(y,b),b!==r)N.current=N.current+j.current,d==null||d(b);else{const A=p.current.snaps[b];S(A,!0)}}},Ce=(y,b)=>{_.current[b]=y},{canSlideLeft:E,canSlideRight:I,isDraggable:O}=q;return l.jsxs(ye,L(T({},P),{baseClassName:H("vkuiBaseGallery",s==="custom"&&"vkuiBaseGallery--custom-width",O&&"vkuiBaseGallery--draggable"),getRootRef:c,children:[l.jsx(_e,{className:"vkuiBaseGallery__viewport",onStartX:ge,onMoveX:ke,onEnd:pe,style:{width:s==="custom"?"100%":s},getRootRef:w,noSlideClick:!0,children:l.jsx("div",{className:"vkuiBaseGallery__layer",ref:R,children:h.Children.map(i,(y,b)=>l.jsx("div",{className:"vkuiBaseGallery__slide",ref:A=>Ce(A,b),children:y},"slide-".concat(b)))})}),n&&l.jsx("div",{"aria-hidden":!0,className:H("vkuiBaseGallery__bullets",zn[n]),children:h.Children.map(i,(y,b)=>l.jsx("div",{className:H("vkuiBaseGallery__bullet",b===r&&"vkuiBaseGallery__bullet--active")},b))}),x&&Z&&E&&l.jsx(Me,{className:"vkuiBaseGallery__arrow",direction:"left",onClick:ie,size:g}),x&&Z&&I&&l.jsx(Me,{className:"vkuiBaseGallery__arrow",direction:"right",onClick:oe,size:g})]}))};function Xn(t,n,e){const{document:i}=ue(),s=_t(e);h.useEffect(function(){if(!i||!t)return;let a=null;const o=()=>{a&&(clearTimeout(a),a=null)},f=()=>{switch(i.visibilityState){case"visible":o(),a=setTimeout(s,t);break;case"hidden":o()}};return f(),i.addEventListener("visibilitychange",f),()=>{o(),i.removeEventListener("visibilitychange",f)}},[i,t,n,s])}const Wn=t=>{var{initialSlideIndex:n=0,children:e,timeout:i=0,onChange:s,bullets:r,looped:a}=t,o=V(t,["initialSlideIndex","children","timeout","onChange","bullets","looped"]);const[f,d]=h.useState(n),m=typeof o.slideIndex=="number";var u;const v=m?(u=o.slideIndex)!==null&&u!==void 0?u:0:f,x=h.useMemo(()=>h.Children.toArray(e).filter(c=>!!c),[e]),C=x.length,g=Ue(),P=h.useCallback(c=>{c!==v&&(!m&&d(c),s&&s(c))},[m,s,v]);Xn(i,v,()=>P((v+1)%C));const _=C>0?be(v,0,C-1):v;if(h.useEffect(()=>{s&&_!==v&&s(_),d(_)},[s,_,v]),!g)return null;const p=a?Hn:Pn;return l.jsx(p,L(T({dragDisabled:m&&!s},o),{bullets:C>0&&r,slideIndex:_,onChange:P,children:x}))},Gn=t=>{var{className:n}=t,e=V(t,["className"]);const{size:i}=h.useContext(Ke);return l.jsx(he.Badge,L(T({},e),{className:H("vkuiGridAvatarBadge",i<96&&"vkuiGridAvatarBadge--shifted",n)}))},Yn=48,Vn=4,st=t=>{var{src:n=[],size:e=Yn,className:i,children:s}=t,r=V(t,["src","size","className","children"]);return l.jsxs(he,L(T({},r),{size:e,className:H("vkuiGridAvatar",i),children:[l.jsx("div",{className:"vkuiGridAvatar__in","aria-hidden":!0,children:n.map((a,o)=>o<Vn?l.jsx("div",{className:"vkuiGridAvatar__item",style:{backgroundImage:"url(".concat(a,")")}},o):null)}),s]}))};st.Badge=Gn;const $n=Pt.lazy(()=>Nt(()=>import("./MarkdownText-DUGOdKV1.js"),__vite__mapDeps([0,1,2]),import.meta.url));function Xe(t){return new Date(t*1e3).toLocaleString()}const Kn=({ticket:t})=>{const n=t.media.filter(a=>a.mimetype.includes("image")),e=t.media.filter(a=>!a.mimetype.includes("image")),[i,s]=h.useState(!1),r=l.jsx("div",{className:"gallery-overlay",children:l.jsx(Mn,{activeModal:"gallery",children:l.jsx(Cn,{id:"gallery",onClose:()=>s(!1),style:{background:"none"},children:l.jsx(Wn,{slideWidth:"100%",bullets:"dark",showArrows:!0,looped:!0,children:n.map((a,o)=>l.jsx("img",{src:a.url,alt:"image-".concat(o),style:{width:"100%",height:"100%"}},o))})})})});return l.jsxs("div",{children:[l.jsxs("div",{className:"message",children:[n.length>0&&l.jsx("div",{className:"message__img",onClick:()=>s(!0),children:l.jsx(st,{src:n.slice(0,3).map(a=>a.url)})}),l.jsxs("div",{className:"message__content",children:[l.jsx("div",{className:"message__title",children:t.title}),l.jsx("div",{className:"message__description",children:l.jsx($n,{text:t.description})}),t.groups.length>0&&l.jsx("div",{className:"message__tags",children:t.groups.join(", ")}),l.jsx("div",{className:"message__date",children:Xe(t.time)})]})]}),e.length>0&&l.jsx("div",{className:"message",children:l.jsxs("div",{className:"message__content",children:[e.map(a=>l.jsxs("a",{href:a.url,download:a.name,target:"_blank",className:"file",children:[l.jsx("div",{className:"file__icon",children:l.jsx($t,{})}),l.jsx("div",{className:"file__content",children:l.jsx("div",{className:"file__name",children:a.name})})]},a.index)),l.jsx("div",{className:"message__date",children:Xe(t.time)})]})}),i&&At.createPortal(r,document.getElementById("gallery-portal"))]})};export{Kn as PreviewMessage,Kn as default};
